@if (loading) {
  <div style="width: fit-content; margin: 7em auto">
    <p-progressSpinner ariaLabel="loading" />
  </div>
}

@if (tratta() && sanitizedSrc) {
  <div class="tratta-container">
    @if (tratta().trattaId == id()) {
      <div class="tratta-incontainer">
        <div class="iframe">
          <iframe
            style="border-radius: 12px; position: sticky; top: 4em"
            [src]="sanitizedSrc"
            width="98%"
            height="500"
            frameBorder="0"
            allowfullscreen=""
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
            loading="lazy"
          ></iframe>
        </div>
        <div class="line">
          <ul>
            @for (station of tratta().stations; track station) {
              <li
                data-bs-toggle="modal"
                data-bs-target="#exampleModal"
                (click)="
                  stationToModal(station, tratta().gestore, tratta().note)
                "
              >
                {{ station.station }}
              </li>
            }
          </ul>
        </div>
      </div>
    }
  </div>
}

<!-- Modal -->
<div
  class="modal fade"
  id="exampleModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          Stazione di {{ actualStation().station }}
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        @if (tratta().gestore === "RFI") {
          <p-button
            label="Arrivi"
            (onClick)="openArrivals()"
          />
          <p-button
            label="Partenze"
            (onClick)="openDepartures()"
          />
        }
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close
        </button>
        <button type="button" class="btn btn-primary" (click)="openMaps()">
          Apri su Maps
        </button>
      </div>
    </div>
  </div>
</div>
